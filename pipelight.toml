# Pipelight Pipeline: Swab the Deck with Free-Tier AI
## Scheduled Hecke-Maass Sharding + AI Analysis

triggers:
  - name: daily_swab
    cron: "0 2 * * *"  # 2 AM daily
  - name: on_push
    branch: main

pipelines:
  swab_deck:
    steps:
      - name: swab_rust
        commands:
          - cd swab-deck && cargo run --release -- all
      
      - name: analyze_with_gemini
        commands:
          - nix develop .#gemini-cli -c gemini-analyze-shards
      
      - name: analyze_with_claude
        commands:
          - nix develop .#claude-cli -c claude-analyze-shards
      
      - name: analyze_with_gpt
        commands:
          - nix develop .#openai-cli -c gpt-analyze-shards
      
      - name: analyze_with_llama
        commands:
          - nix develop .#ollama -c ollama-analyze-shards
      
      - name: consensus
        commands:
          - python3 ai_consensus.py
      
      - name: commit_results
        commands:
          - git add HECKE_MAASS_MANIFEST.json AI_ANALYSIS.json
          - git commit -m "chore: swab deck $(date +%Y-%m-%d)" || true
          - git push || true
  
  moltbook_register:
    steps:
      - name: generate_post
        commands:
          - python3 generate_moltbook_post.py
      
      - name: openclaw_post
        commands:
          - bash openclaw_post.sh || echo "OpenClaw posting requires manual authentication"
      
      - name: fallback_instructions
        commands:
          - echo "═══════════════════════════════════════════════════════════"
          - echo "If OpenClaw posting failed, post manually:"
          - echo "1. Visit https://www.moltbook.com"
          - echo "2. Register via OpenClaw"
          - echo "3. Copy content from moltbook_post.txt"
          - echo "4. Post to /ai-agents/ submolt"
          - echo "═══════════════════════════════════════════════════════════"

options:
  detach: false
  log_level: info
